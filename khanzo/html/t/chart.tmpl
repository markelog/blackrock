
<tr id="{{ .Data.Key }}">
  <td class="left">
    {{ .Data.Key }} ({{ (len .Data.Values) }})
  </td>
  <td class="right">
    total: {{ .Data.TotalCount }} {{ percent .GlobalTotal .Data.TotalCount }}
  </td>
</tr>
{{ $total := .Data.TotalCount }}
{{ $b := .BaseUrl }}
{{ $qs := .QueryString }}
{{ $tag := .Data.Key }}
{{ $link := .Link }}
{{ $limit := getN $qs .Data.Key 50 }}
{{ range $i, $val := .Data.Values }}
{{ $p := percent $total $val.Count }}

{{ if lt $i $limit}}
<tr>
  <td class="left">
    {{ if $link }}
    <div style="padding-left: 1.5em;">
    {{ $p := ctx $tag $val.Value }}
    {{ $name := findFirstNameOrDefault $p $val.Value }}
    {{ if $p }}
    <label class="trigger">
      <input type="checkbox"/>
      <span class="msg">
        <table>
          <tr><td colspan=2><b><a href="{{$b}}/{{$tag}}:{{$val.Value}}?{{$qs}}">{{ $name }}</a></b></td></tr>
          {{ range $p }}
          <tr><td><b>{{.ForeignType}}</b></td><td>{{.ForeignId}}</td></tr>
          {{ range .Properties }}
          <tr><td>{{prettyFlat .Key}}</td><td>{{ .Value}}</td></tr>
          {{ end }}
          <tr><td colspan=1><hr /></td></tr>
          {{ end }}
        </table>
      </span>
    </label>
    {{ end }}
    <a href="{{$b}}/{{$tag}}:{{$val.Value}}?{{$qs}}">{{ $name }}</a>
    </div>
    {{ else }}
    <div style="padding-left: 1.5em">{{ $val.Value }}</div>
    {{ end }}
  </td>
  <td class="right">
    <div style="position: relative">
     <div style="display: inline-block; z-index: 1">{{ format $val.Count }} ({{$p}}%)</div>
     <div style="position: absolute; left: 0; bottom: 0;  display: inline-block; width: {{$p}}%; background-color: rgba(200,200,200,0.5);">&nbsp;</div>
    </div>
  </td>
</tr>
{{ end }}

{{ end }}

{{ if gt (len .Data.Values) $limit }}
<tr>
  <td class="left" colspan=2>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<a href="{{$b}}?{{addN $qs .Data.Key 100}}#{{.Data.Key}}">skipping {{ minus (len .Data.Values) $limit }}</a>
  </td>
</tr>

{{end}}
<tr>
  <td>&nbsp;</td>
</tr>

